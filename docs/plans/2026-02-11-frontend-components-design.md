# å‰ç«¯ç»„ä»¶è¡¥å…¨è®¾è®¡æ–¹æ¡ˆ

> æ—¥æœŸï¼š2026-02-11
> çŠ¶æ€ï¼šå¾…å®æ–½
> å‰ç½®æ–‡æ¡£ï¼š[chat-ui-design.md](./2026-02-11-chat-ui-design.md)ã€[theme-spec.md](../theme-spec.md)

## æ¦‚è¿°

è¡¥å…¨å‰ç«¯ç¼ºå¤±ç»„ä»¶ï¼Œä½¿äº§å“ä¸»æµç¨‹ï¼ˆå…«å­—åˆ†æ â†’ 3D ç”Ÿæˆ â†’ æŸ¥çœ‹æ¨¡å‹ï¼‰å®Œæ•´å¯ç”¨ã€‚èŒƒå›´åŒ…æ‹¬ï¼š

1. **BaguaCard** â€” å…«å­—åˆ†æç»“æœå¯è§†åŒ–å¡ç‰‡
2. **ModelPreview** â€” 3D æ¨¡å‹ç¼©ç•¥å›¾é¢„è§ˆå¡ç‰‡
3. **æ¶ˆæ¯é‡æ–°ç”Ÿæˆ** â€” reload åŠŸèƒ½å®ç°
4. **æ¶ˆæ¯æŒä¹…åŒ–** â€” IndexedDB å¤šä¼šè¯å­˜å‚¨
5. **ä¾§è¾¹æ ** â€” ä¼šè¯å†å²åˆ—è¡¨ + ä¸»é¢˜åˆ‡æ¢è¿ç§»

## æ¶æ„å†³ç­–

### å·¥å…·ç»“æœå¯è§†åŒ–æ–¹æ¡ˆ

é‡‡ç”¨ **æ–¹æ¡ˆ Aï¼šæ‰©å±• tool-call æ¸²æŸ“å±‚**ã€‚

å½“å‰æ•°æ®æµï¼š

```
åç«¯å·¥å…·æ‰§è¡Œ â†’ result ä¼ ç»™ DeepSeek â†’ AI ç”¨æ–‡å­—æè¿° â†’ å‰ç«¯åªæ¸²æŸ“æ–‡å­—
```

æ”¹é€ åï¼š

```
åç«¯å·¥å…·æ‰§è¡Œ â†’ result åŒæ—¶ä¼ ç»™ DeepSeek å’Œå‰ç«¯
                                    â†“
                          å‰ç«¯æ ¹æ® tool name åˆ†å‘æ¸²æŸ“
                          analyzeBazi â†’ BaguaCard
                          generateMascot â†’ ModelPreview
```

å®ç°æ–¹å¼ï¼š`ChatMessage` ä¸­æ£€æµ‹ `tool-call` part çš„ `name` å’Œ `status`ï¼Œå½“ `status === 'complete'` æ—¶è§£æ `result`ï¼ˆJSON å­—ç¬¦ä¸²ï¼‰æ¸²æŸ“å¯¹åº”å¡ç‰‡ã€‚ä¸æ”¹å˜ AI SDK çš„ `toUIMessageStreamResponse()` åè®®ï¼Œä¸å¼•å…¥æ–° SSE äº‹ä»¶ç±»å‹ã€‚

## ä¸€ã€BaguaCard ç»„ä»¶

### ä½ç½®

åµŒå…¥èŠå¤©æ¶ˆæ¯æµã€‚`ChatMessage` ä¸­å½“ `tool-call.name === 'analyzeBazi'` ä¸” `status === 'complete'` æ—¶ï¼Œæ›¿ä»£ `ToolStatus` æ¸²æŸ“ `BaguaCard`ã€‚

### æ•°æ®æº

```ts
// tool-call part çš„ result å­—æ®µï¼ŒJSON.parse åç»“æ„ï¼š
{ success: true, data: BaziResult }
```

`BaziResult` ç±»å‹å®šä¹‰è§ `lib/bazi/types.ts`ã€‚

### ç²¾ç®€å±‚ï¼ˆé»˜è®¤å±•ç¤ºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…«å­—å‘½ç›˜                                 â–¼ å±•å¼€è¯¦æƒ…  â”‚
â”‚                                                     â”‚
â”‚    å¹´æŸ±        æœˆæŸ±        æ—¥æŸ±(ä¸»)      æ—¶æŸ±        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”        â”‚
â”‚   â”‚ ç”²  â”‚    â”‚ ä¸™  â”‚    â”‚  å£¬ â˜…  â”‚    â”‚ åºš  â”‚        â”‚
â”‚   â”‚ å¯…  â”‚    â”‚ åˆ  â”‚    â”‚  è¾°    â”‚    â”‚ å­  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”˜        â”‚
â”‚                                                     â”‚
â”‚  äº”è¡Œåˆ†å¸ƒ                                            â”‚
â”‚  æœ¨ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 4                                  â”‚
â”‚  ç« â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 3                                  â”‚
â”‚  åœŸ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 2                                  â”‚
â”‚  é‡‘ â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 1                                  â”‚
â”‚  æ°´ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 3                                  â”‚
â”‚                                                     â”‚
â”‚  æ—¥ä¸» å£¬æ°´ Â· å±é¾™ Â· å£¬è¾° ç”²åˆ ä¸™å¯… åºšå­               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- å››æŸ±æ¨ªæ’ï¼Œæ¯æŸ±ä¸Šæ–¹å¤©å¹²ã€ä¸‹æ–¹åœ°æ”¯
- å¤©å¹²åœ°æ”¯æ–‡å­—ç”¨äº”è¡Œå¯¹åº”è‰²æ ‡æ³¨ï¼š
  - æœ¨ â†’ hue 155ï¼ˆç»¿ï¼Œä¸ primary åŒç³»ï¼‰
  - ç« â†’ hue 25ï¼ˆçº¢ï¼Œä¸ destructive åŒç³»ï¼‰
  - åœŸ â†’ hue 85ï¼ˆé»„ï¼‰
  - é‡‘ â†’ hue 60ï¼ˆé‡‘ï¼‰æˆ–ä½ chromaï¼ˆç°ç™½ï¼‰
  - æ°´ â†’ hue 240ï¼ˆè“ï¼‰
- äº”è¡Œè‰²åœ¨æš—è‰²æ¨¡å¼ä¸‹ L å€¼æå‡ +0.15~0.2ï¼Œä¿æŒå¯è¯»æ€§
- æ—¥æŸ±ï¼ˆæ—¥ä¸»ï¼‰ç”¨ `--primary` è¾¹æ¡†é«˜äº®
- äº”è¡Œæ¡å½¢å›¾æŒ‰ `fiveElements` count æ¯”ä¾‹æ¸²æŸ“
- åº•éƒ¨æ‘˜è¦ï¼šæ—¥ä¸» + ç”Ÿè‚– + å…«å­—åŸæ–‡

### è¯¦æƒ…å±‚ï¼ˆç‚¹å‡»å±•å¼€åï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…«å­—å‘½ç›˜                                 â–² æ”¶èµ·     â”‚
â”‚                                                     â”‚
â”‚  ï¼ˆç²¾ç®€å±‚å†…å®¹ï¼‰                                       â”‚
â”‚                                                     â”‚
â”‚  â”€â”€ è—å¹² â”€â”€                                         â”‚
â”‚  å¹´: ç”²(æ¯”è‚©) ä¸™(é£Ÿç¥) æˆŠ(åè´¢)                      â”‚
â”‚  æœˆ: ä¸(ä¼¤å®˜) å·±(æ­£è´¢)                                â”‚
â”‚  æ—¥: æˆŠ(åè´¢) ä¹™(ä¼¤å®˜) ç™¸(åŠ«è´¢)                      â”‚
â”‚  æ—¶: ç™¸(åŠ«è´¢)                                        â”‚
â”‚                                                     â”‚
â”‚  â”€â”€ çº³éŸ³ â”€â”€                                         â”‚
â”‚  å¹´: å¤§æºªæ°´  æœˆ: å¤©æ²³æ°´  æ—¥: æ²™ä¸­åœŸ  æ—¶: å£ä¸ŠåœŸ        â”‚
â”‚                                                     â”‚
â”‚  â”€â”€ ç¥ç… â”€â”€                                         â”‚
â”‚  å¤©ä¹™è´µäºº Â· æ–‡æ˜Œ Â· é©¿é©¬ Â· ...                        â”‚
â”‚                                                     â”‚
â”‚  â”€â”€ å¤§è¿ï¼ˆ10æ­¥ï¼‰â”€â”€                                   â”‚
â”‚  ä¹™å·³(3-12) ä¸™åˆ(13-22) ä¸æœª(23-32) æˆŠç”³(33-42)     â”‚
â”‚  å·±é…‰(43-52) åºšæˆŒ(53-62) è¾›äº¥(63-72) å£¬å­(73-82)    â”‚
â”‚  ç™¸ä¸‘(83-92) ç”²å¯…(93-102)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- è—å¹²æ¯é¡¹æ ‡æ³¨åç¥
- å¤§è¿ 10 æ­¥ï¼Œæ˜¾ç¤ºå¹²æ”¯ + èµ·æ­¢å¹´é¾„ï¼Œæ¨ªå‘æ’åˆ—è‡ªåŠ¨æ¢è¡Œ
- å±•å¼€/æŠ˜å ç”¨ `transition-all duration-300`

### è§†è§‰è§„èŒƒ

- å¡ç‰‡ `bg-card rounded-lg border border-border p-4`
- æ ‡é¢˜ "å…«å­—å‘½ç›˜" ä½¿ç”¨ `font-[var(--font-display)]`ï¼ˆNoto Serif SCï¼‰
- æ·±è‰²/æµ…è‰²è‡ªåŠ¨é€‚é…ï¼ˆé€šè¿‡ CSS å˜é‡ï¼‰
- å®½åº¦æ’‘æ»¡æ¶ˆæ¯æ°”æ³¡ `max-w-[80%]`

### æ–‡ä»¶

- `components/chat/bagua-card.tsx`

## äºŒã€ModelPreview ç»„ä»¶

### ä½ç½®

åµŒå…¥èŠå¤©æ¶ˆæ¯æµã€‚`ChatMessage` ä¸­å½“ `tool-call.name === 'generateMascot'` ä¸” `status === 'complete'` æ—¶æ¸²æŸ“ã€‚

### æ•°æ®æº

```ts
// tool-call part çš„ result å­—æ®µï¼ŒJSON.parse åç»“æ„ï¼š
{ success: true, modelUrl: "https://...", renderedImage: "https://...", taskId: "..." }
```

> æ³¨æ„ï¼šå½“å‰ `generateMascot` å·¥å…·åªè¿”å› `modelUrl`ï¼Œéœ€è¡¥å……è¿”å› `renderedImage`ï¼ˆTripo API çš„ `output.rendered_image`ï¼‰ã€‚

### å¡ç‰‡è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â”‚     [é¢„è§ˆå›¾ / å ä½å›¾]        â”‚  â”‚
â”‚    â”‚     aspect-video            â”‚  â”‚
â”‚    â”‚                             â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚         [ æŸ¥çœ‹ 3D æ¨¡å‹ ]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ç¼©ç•¥å›¾åŒºåŸŸï¼š`aspect-video bg-muted rounded-md overflow-hidden`
  - æœ‰ `renderedImage` â†’ æ˜¾ç¤º `<img>`
  - æ—  `renderedImage` â†’ å ä½ï¼šæ¨¡å‹å›¾æ ‡ + "3D æ¨¡å‹å·²ç”Ÿæˆ" æ–‡å­—
- åº•éƒ¨æŒ‰é’®ï¼š`primary` variantï¼Œç‚¹å‡»è°ƒç”¨ `useChatStore.setModelUrl(url)` â†’ è§¦å‘åˆ†å±
- åŠ è½½ä¸­çŠ¶æ€ï¼ˆ`status === 'calling'`ï¼‰ï¼š`Loader2` æ—‹è½¬ + "æ­£åœ¨ç”Ÿæˆ 3D æ¨¡å‹..."

### åç«¯æ”¹åŠ¨

`app/api/chat/route.ts` ä¸­ `generateMascot` å·¥å…·çš„è¿”å›å€¼è¡¥å…… `renderedImage`ï¼š

```ts
return {
  success: true,
  modelUrl: result.output?.model,
  renderedImage: result.output?.rendered_image,
  taskId,
}
```

### è§†è§‰è§„èŒƒ

- å¡ç‰‡ `bg-card rounded-lg border border-border p-3`
- æŒ‰é’®å±…ä¸­ï¼Œ`mt-3`
- æ·±è‰²/æµ…è‰²è‡ªåŠ¨é€‚é…

### æ–‡ä»¶

- `components/chat/model-preview.tsx`

## ä¸‰ã€æ¶ˆæ¯é‡æ–°ç”Ÿæˆ

### å½“å‰çŠ¶æ€

`hooks/use-mock-chat.ts` ä¸­ `reload` ä¸ºç©º stubã€‚

### å®ç°é€»è¾‘

```ts
const reload = useCallback(() => {
  if (isLoading) return
  // 1. æ‰¾åˆ°æœ€åä¸€æ¡ user æ¶ˆæ¯
  const lastUserIndex = messages.findLastIndex(m => m.role === 'user')
  if (lastUserIndex === -1) return
  const lastUserContent = messages[lastUserIndex].content
  // 2. ç§»é™¤è¯¥ user æ¶ˆæ¯ä¹‹åçš„æ‰€æœ‰ assistant æ¶ˆæ¯
  setMessages(prev => prev.slice(0, lastUserIndex + 1))
  // 3. é‡æ–°å‘é€
  sendMessage(lastUserContent)
}, [isLoading, messages, sendMessage])
```

### è¾¹ç•Œå¤„ç†

- `isLoading === true` æ—¶è·³è¿‡
- æ—  user æ¶ˆæ¯æ—¶è·³è¿‡
- ä¼ ç»™ `/api/chat` çš„æ¶ˆæ¯å†å²ä¸å«è¢«åˆ é™¤çš„ assistant æ¶ˆæ¯

### æ–‡ä»¶

- `hooks/use-mock-chat.ts`ï¼ˆä¿®æ”¹ `reload` å‡½æ•°ï¼‰

## å››ã€æ¶ˆæ¯æŒä¹…åŒ–

### æŠ€æœ¯é€‰æ‹©

`idb@8.0.3`ï¼ˆå·²å®‰è£…ï¼‰ï¼Œè½»é‡ IndexedDB å°è£…ã€‚

### å­˜å‚¨ç»“æ„

```ts
// DB: 'tripo-bagua', version: 1
// Object Stores:

interface Session {
  id: string           // UUID
  title: string        // å–ç¬¬ä¸€æ¡ user æ¶ˆæ¯å‰ 20 å­—
  createdAt: number    // timestamp
  updatedAt: number    // timestamp
}

interface SessionMessages {
  sessionId: string    // å…³è” Session.id
  messages: Message[]  // å®Œæ•´æ¶ˆæ¯æ•°ç»„
}
```

- Store `sessions`ï¼škey = `id`ï¼Œindex on `updatedAt`ï¼ˆç”¨äºæ’åºï¼‰
- Store `messages`ï¼škey = `sessionId`

### è¡Œä¸º

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| é¦–æ¬¡è®¿é—® | åˆ›å»ºæ–° sessionï¼Œç©ºæ¶ˆæ¯ |
| å‘é€/æ¥æ”¶æ¶ˆæ¯ | debounce 300ms å†™å…¥ IndexedDB |
| åˆ·æ–°é¡µé¢ | è¯»å–æœ€è¿‘ä¸€ä¸ª sessionï¼ˆæŒ‰ updatedAt å€’åºï¼‰æ¢å¤ |
| åˆ‡æ¢ä¼šè¯ | ä¿å­˜å½“å‰ â†’ åŠ è½½ç›®æ ‡ session çš„æ¶ˆæ¯ |
| æ–°å»ºå¯¹è¯ | åˆ›å»ºæ–° sessionï¼Œæ¸…ç©ºæ¶ˆæ¯åˆ—è¡¨ |
| åˆ é™¤ä¼šè¯ | åŒæ—¶åˆ é™¤ sessions å’Œ messages è®°å½• |
| ä¼šè¯æ ‡é¢˜ | è‡ªåŠ¨å–ç¬¬ä¸€æ¡ user æ¶ˆæ¯å‰ 20 å­—ï¼Œæ—  user æ¶ˆæ¯åˆ™ "æ–°å¯¹è¯" |

### æ–‡ä»¶

- `lib/persistence/chat-db.ts` â€” IndexedDB æ“ä½œå°è£…ï¼ˆopenDB / getSession / saveSession / deleteSession / listSessionsï¼‰
- `hooks/use-mock-chat.ts` â€” é›†æˆåˆå§‹åŒ–è¯»å– + å˜åŒ–å†™å…¥

## äº”ã€ä¾§è¾¹æ 

### èƒŒæ™¯

å¼•å…¥å¤šä¼šè¯å†å²åéœ€è¦ä¼šè¯ç®¡ç† UIã€‚åŒæ—¶å°†ä¸»é¢˜åˆ‡æ¢ä» `ChatInput` è¿ç§»è‡³ä¾§è¾¹æ ã€‚

### å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SIDEBAR  â”‚                                          â”‚
â”‚          â”‚              MAIN AREA                   â”‚
â”‚ ~240px   â”‚         Chat / Split Layout              â”‚
â”‚          â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

åˆ†å±æ¨¡å¼ä¸‹ä¾§è¾¹æ è‡ªåŠ¨æŠ˜å ä¸ºå›¾æ ‡æ ï¼ˆ~48pxï¼‰ï¼Œç»™æ¨¡å‹æŸ¥çœ‹å™¨ç•™å‡ºç©ºé—´ã€‚

### ä¾§è¾¹æ ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”® Tripo Bagua     â”‚  â† Logo + æ ‡é¢˜
â”‚ [+ æ–°å¯¹è¯]          â”‚  â† æ–°å»ºæŒ‰é’®
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    â”‚
â”‚ â— æˆ‘1990å¹´å‡ºç”Ÿ...   â”‚  â† ä¼šè¯åˆ—è¡¨ï¼ˆæŒ‰æ—¶é—´å€’åºï¼‰
â”‚   2/11 14:30       â”‚
â”‚                    â”‚
â”‚ â— å¸®æˆ‘åˆ†æä¸€ä¸‹...   â”‚
â”‚   2/11 10:15       â”‚
â”‚                    â”‚
â”‚ â— 1985å¹´3æœˆ...     â”‚
â”‚   2/10 22:00       â”‚
â”‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â˜€/ğŸŒ™ ä¸»é¢˜åˆ‡æ¢]     â”‚  â† åº•éƒ¨ï¼šä¸»é¢˜åˆ‡æ¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº¤äº’

- ç‚¹å‡»ä¼šè¯é¡¹ â†’ åˆ‡æ¢åˆ°è¯¥ä¼šè¯
- ä¼šè¯é¡¹ hover â†’ æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
- æ–°å¯¹è¯æŒ‰é’® â†’ åˆ›å»ºç©º session å¹¶åˆ‡æ¢
- ä¾§è¾¹æ å¯é€šè¿‡æ±‰å ¡æŒ‰é’®æ‰‹åŠ¨æ”¶èµ·/å±•å¼€
- åˆ†å±æ¨¡å¼è‡ªåŠ¨æ”¶èµ·ä¸ºå›¾æ ‡æ 
- ä¸»é¢˜åˆ‡æ¢æŒ‰é’®å›ºå®šåœ¨åº•éƒ¨

### å¯¹ç°æœ‰ä»£ç çš„å½±å“

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `app/page.tsx` | å¼•å…¥ Sidebarï¼Œè°ƒæ•´å¸ƒå±€ä¸ºä¸‰æ  |
| `components/chat/chat-input.tsx` | ç§»é™¤ä¸»é¢˜åˆ‡æ¢é€»è¾‘ï¼ˆisDark / toggleTheme / Sun/Moonï¼‰ |
| `stores/chat-store.ts` | æ–°å¢ `currentSessionId`ã€`sidebarOpen` çŠ¶æ€ |

### æ ·å¼

ä½¿ç”¨å·²æœ‰çš„ sidebar tokenï¼ˆ`--sidebar`ã€`--sidebar-foreground`ã€`--sidebar-border` ç­‰ï¼‰ï¼Œä¸ä¸»å†…å®¹åŒºè§†è§‰åˆ†å±‚ã€‚

### æ–‡ä»¶

- `components/sidebar/index.tsx` â€” ä¾§è¾¹æ ä¸»ç»„ä»¶
- `components/sidebar/session-item.tsx` â€” ä¼šè¯åˆ—è¡¨é¡¹
- `components/sidebar/theme-toggle.tsx` â€” ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼ˆä» ChatInput è¿å‡ºï¼‰

## ç›®å½•ç»“æ„å˜æ›´

```diff
 components/
 â”œâ”€â”€ chat/
+â”‚   â”œâ”€â”€ bagua-card.tsx          # å…«å­—å¯è§†åŒ–å¡ç‰‡
+â”‚   â”œâ”€â”€ model-preview.tsx       # 3D æ¨¡å‹é¢„è§ˆå¡ç‰‡
 â”‚   â”œâ”€â”€ chat-message.tsx        # ä¿®æ”¹ï¼šåˆ†å‘ tool-call æ¸²æŸ“
 â”‚   â”œâ”€â”€ chat-input.tsx          # ä¿®æ”¹ï¼šç§»é™¤ä¸»é¢˜åˆ‡æ¢é€»è¾‘
 â”‚   â””â”€â”€ ...
+â”œâ”€â”€ sidebar/
+â”‚   â”œâ”€â”€ index.tsx               # ä¾§è¾¹æ ä¸»ç»„ä»¶
+â”‚   â”œâ”€â”€ session-item.tsx        # ä¼šè¯åˆ—è¡¨é¡¹
+â”‚   â””â”€â”€ theme-toggle.tsx        # ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
 â”œâ”€â”€ model-viewer/
 â”‚   â””â”€â”€ index.tsx
 â””â”€â”€ ui/
     â””â”€â”€ ...

+lib/
+â”œâ”€â”€ persistence/
+â”‚   â””â”€â”€ chat-db.ts              # IndexedDB æ“ä½œå°è£…

 hooks/
 â””â”€â”€ use-mock-chat.ts            # ä¿®æ”¹ï¼šreload å®ç° + æŒä¹…åŒ–é›†æˆ

 stores/
 â””â”€â”€ chat-store.ts               # ä¿®æ”¹ï¼šæ–°å¢ sessionId / sidebarOpen

 app/
 â”œâ”€â”€ page.tsx                    # ä¿®æ”¹ï¼šä¸‰æ å¸ƒå±€
 â””â”€â”€ api/chat/route.ts           # ä¿®æ”¹ï¼šgenerateMascot è¡¥å…… renderedImage
```

## å®æ–½ä¼˜å…ˆçº§

1. **BaguaCard** â€” æ ¸å¿ƒä»·å€¼å±•ç¤ºï¼Œæ— å¤–éƒ¨ä¾èµ–
2. **ModelPreview** â€” è¡¥å…¨ç”Ÿæˆæµç¨‹é—­ç¯ï¼ˆå«åç«¯å°æ”¹åŠ¨ï¼‰
3. **æ¶ˆæ¯é‡æ–°ç”Ÿæˆ** â€” æ”¹åŠ¨æœ€å°ï¼Œç‹¬ç«‹å®Œæˆ
4. **æ¶ˆæ¯æŒä¹…åŒ–** â€” åŸºç¡€è®¾æ–½ï¼Œä¾§è¾¹æ çš„å‰ç½®ä¾èµ–
5. **ä¾§è¾¹æ ** â€” ä¾èµ–æŒä¹…åŒ–ï¼Œæ¶‰åŠå¸ƒå±€é‡æ„
